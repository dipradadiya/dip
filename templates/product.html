{% extends "base.html" %}

{% block head_title %}Product Details{% endblock %}

{% block css %}
<style>
/* Global Styles */
body, html {
    margin: 0;
    padding: 0;
    background-color: #f8f9fa;
    font-family: 'Arial', sans-serif;
}

/* Main Container */
.container {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
}

/* Product Section */
.product-section {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.1);
}

/* Product Image */
.product-image {
    width: 100%;
    max-width: 500px;
    height: auto;
    border-radius: 10px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease-in-out;
}

.product-image:hover {
    transform: scale(1.05);
}

/* Product Details */
.product-details {
    flex: 1;
    padding: 20px;
}

/* Price */
.price {
    font-size: 22px;
    font-weight: bold;
    color: #28a745;
}

/* Buttons */
.btn-primary, .btn-danger {
    width: 48%;
    text-align: center;
    font-size: 16px;
    padding: 12px;
    border-radius: 5px;
    transition: all 0.3s ease;
    font-weight: bold;
}

.btn-primary:hover {
    background-color: #007bff;
    transform: scale(1.05);
}

.btn-danger:hover {
    background-color: #dc3545;
    transform: scale(1.05);
}

/* Reviews Section */
.reviews {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

/* Star Rating Display */
.stars {
    color: gold;
    font-size: 18px;
    margin-bottom: 5px;
}

/* Review Form */
.review-form textarea {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    resize: none;
}

.review-form button {
    width: 100%;
    font-size: 16px;
    padding: 12px;
    border-radius: 5px;
    transition: all 0.3s ease;
    font-weight: bold;
}

.review-form button:hover {
    background-color: #007bff;
    transform: scale(1.05);
}

/* Interactive Star Rating */
.rating {
    direction: rtl;
    display: flex;
    justify-content: center;
    gap: 5px;
}

.rating input {
    display: none;
}

.rating label {
    font-size: 30px;
    color: #ddd;
    cursor: pointer;
}

.rating input:checked ~ label,
.rating label:hover,
.rating label:hover ~ label {
    color: gold;
}
</style>
{% endblock css %}

{% block content %}
  <main class="mt-5 pt-4">
    <div class="container">

      <!-- Product Details Section -->
      <div class="product-section">

        <!-- Product Image -->
        <div>
          <img src="{{ item.image.url }}" class="product-image" alt="{{ item.title }}">
        </div>

        <!-- Product Information -->
        <div class="product-details">

          <!-- Product Title -->
          <h2 class="product-title">{{ object.title }}</h2>

          <!-- Price -->
          <p class="price">
            {% if object.discount_price %}
              <del>₹{{ object.price }}</del> ₹{{ object.discount_price }}
            {% else %}
              ₹{{ object.price }}
            {% endif %}
          </p>

          <!-- Product Description -->
          <p>{{ object.description }}</p>

              <!-- Additional Details -->
              <p><strong>Category:</strong> {{ object.category }}</p>
              <p><strong>Slug:</strong> {{ object.slug }}</p>

              <!-- 🔥 Add Stock Availability Here -->
              <p><strong>Stock Available:</strong> {{ object.stock }}</p>

          <!-- Add to Cart Buttons -->
          <div class="d-flex justify-content-between">
            <a href="{{ object.get_add_to_cart_url }}" class="btn btn-primary">
              Add to Cart <i class="fas fa-shopping-cart ml-1"></i>
            </a>
            <a href="{{ object.get_remove_from_cart_url }}" class="btn btn-danger">
              Remove from Cart
            </a>
          </div>

          <!-- Customer Reviews Section -->
          <div class="reviews mt-4">
              <h4>Customer Reviews</h4>
              <div style="max-height: 300px; overflow-y: auto;">
                  {% for review in reviews %}
                      <div>
                          <strong>{{ review.user.username }}</strong>
                          <div class="stars">
                              {% for i in "12345"|make_list %}
                                  {% if forloop.counter <= review.rating %}
                                      ⭐
                                  {% else %}
                                      ☆
                                  {% endif %}
                              {% endfor %}
                          </div>
                          <p>{{ review.comment }}</p>
                      </div>
                      <hr>
                  {% empty %}
                      <p>No reviews yet. Be the first to review!</p>
                  {% endfor %}
              </div>
          </div>

          <!-- Review Form -->
          {% if user.is_authenticated %}
                  <h4>Leave a Review</h4>
                  <form id="review-form" method="POST" class="review-form">
                      {% csrf_token %}

                      <!-- Star Rating Input -->
                      <div class="rating">
                          <input type="radio" name="rating" id="star5" value="5"><label for="star5">★</label>
                          <input type="radio" name="rating" id="star4" value="4"><label for="star4">★</label>
                          <input type="radio" name="rating" id="star3" value="3"><label for="star3">★</label>
                          <input type="radio" name="rating" id="star2" value="2"><label for="star2">★</label>
                          <input type="radio" name="rating" id="star1" value="1"><label for="star1">★</label>
                      </div>

                      <textarea name="comment" rows="4" class="form-control" placeholder="Write your review here..." required></textarea>
                      <button type="submit" class="btn btn-primary mt-2">Submit Review</button>
                  </form>
              {% else %}
                  <p><a href="{% url 'core:login' %}">Log in</a> to leave a review.</p>
              {% endif %}
          </div>
        </div>
      </div>
    </div>
  </main>

{% endblock content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  // Handle review form submission via AJAX
  $('#review-form').on('submit', function(e) {
    e.preventDefault(); // Prevent default form submission

    // Get form data
    var formData = $(this).serialize();

    // AJAX request to submit the form
    $.ajax({
      url: '{% url "product_review_submit" item.id %}',  // Replace with the actual URL for handling review submission
      type: 'POST',
      data: formData,
      success: function(response) {
        // On success, reload the reviews section with new content
        $('#reviews-container').html(response.reviews_html);

        // Optionally, clear the form
        $('#review-form')[0].reset();
      },
      error: function(xhr, errmsg, err) {
        alert('Error submitting review: ' + errmsg);
      }
    });
  });
});
</script>
{% block extra_scripts %}


{% endblock extra_scripts %}